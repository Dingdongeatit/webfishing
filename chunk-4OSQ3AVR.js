import{a as f}from"./chunk-Q4YJXWHS.js";import{a as d}from"./chunk-SPMXOJK3.js";import{a as C}from"./chunk-BCG2KUGW.js";import{a as N}from"./chunk-O4TFJKJQ.js";import{e as A,g as b,h as D,k as P,o as u,s as O}from"./chunk-3DTL4XOQ.js";import{c as E,i as L,l as H,o as st}from"./chunk-WSYZUFNR.js";import{c as B}from"./chunk-733SXZOW.js";import{e as w}from"./chunk-3GYLW4KZ.js";async function g(t,e,o,n){let r=Date.now(),a=0,i=t();for(;!i&&a<e;)await ut(o),i=t(),a=Date.now()-r;i&&n(i)}function ut(t){return new Promise(e=>{setTimeout(e,t)})}st();var F=(t,e)=>O("hasActivatedCompetitor",t);async function h(t,e,o){let n=await G(),r=`${t}WarningNotif-${n}`;chrome.storage.local.get(r,a=>{let i=a[r];(e==="cashback"&&b.get(["cashback","user","activated"])||e==="coupons")&&(!i||H(E(L(i),{days:1}),new Date))&&D("notif_reactivation_base")&&(o&&o(),F({domain:n,comp:t}))})}var S;function lt(){let t=S.querySelector('[data-cy="activation-component"]'),e=S.querySelector('[data-cy="activation-heading"]');if(t){let o={subtree:!0,childList:!0};new MutationObserver(i=>{i.forEach(l=>{l?.addedNodes?.length>0&&l?.addedNodes?.forEach(p=>{p instanceof HTMLElement&&p?.innerText.includes("coupons")&&W()})})}).observe(S,o);let r=t.querySelector('button[data-cy="button"]'),a=r.textContent;u("track","citiShopNotification",{name:"cashback",url:location.href,ctaText:a}),r.addEventListener("click",()=>{let i=e&&e.innerText;h("citiShop","cashback"),u("track","citiShopActivate",{url:location.href,cashbackRate:i})})}}function dt(t){f({action:"endSavingsCheck",comp:"citiShop"}),u("track","citiShopTryCouponsResult",{notificationText:t?.notificationText,url:location.href}),h("citiShop","coupons",()=>b.set(["warnAboutStandDown"],!0))}function ft(){let t,e=S.querySelector('[data-cy="non-working-coupons-text"]'),o=[...S.querySelectorAll("h1")].find(r=>r.textContent.match(/applied/i)),n=S.querySelector('[data-cy="cashback-activated-text"]');if(n&&(t=n?.parentElement?.textContent),e&&!n&&(t=e?.textContent),o&&!n&&(t=o.textContent),t)return{notificationText:t}}function W(){let t=S.querySelector('[data-cy="coupon-header-text"]');if(t){let e=t.querySelector("button"),o=e.textContent;u("track","citiShopNotification",{name:"coupons",url:location.href,ctaText:o}),e.addEventListener("click",()=>{f({action:"initSavingsCheck",comp:"citiShop"}),u("track","citiShopTryCoupons",{url:location.href,ctaText:o}),g(ft,4e4,500,dt)})}}async function ht(){d(()=>{let e=[...document.querySelectorAll("x-citi-chrome-extension")].find(o=>{let n=o.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(o);return n&&n?.querySelector('[aria-label="Citi Shop Extension"]')});if(e)return e.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(e)},async t=>{S=t,W(),lt()})}async function I(){try{ht()}catch{}}var k=w(B());var y,U=!1;async function pt(){return d(j,t=>_())}function _(){let t=V();if(t)return $(t),mt(t),t}function mt(t){t.addEventListener("click",()=>{h("coupert","cashback"),u("track","coupertActivate",{url:location.href,cashbackRate:x()})})}function x(){if(!y&&(T(),!y))return null;let t=[...y.querySelectorAll(`div[style*="color: initial;"] div div > div span,
      div[style*="color: initial;"] div div > h3`)].find(o=>!!o.textContent.match(/Cash Back(?! Terms)/));if(t){let o=t.previousElementSibling?t.previousElementSibling.innerText:t.nextElementSibling?t.nextElementSibling.innerText:void 0;return o||null}let e=[...y.querySelectorAll('div[style*="color: initial;"] div div > div > div')].find(o=>o.textContent.includes("Rewards Found!"));if(e){let o=e.nextElementSibling&&e.nextElementSibling.innerText;return o||null}}function $(t){if(U)return;U=!0;let e=x();u("track","coupertNotification",{name:"cashback",url:location.href,ctaText:t.innerText,cashbackRate:e})}async function Y(){d(j,async t=>{let e=!1,o={childList:!0};new MutationObserver(i=>{k.default.forEach(i,async l=>{k.default.get(l,"type")==="childList"&&e===!1&&(e=!0,await pt())})}).observe(t,o);let r=_(),a=await f({action:"getCompState",comp:"coupert"});r&&!a&&$(r)})}function j(){try{let t=T();return!!y?.querySelector("div").innerText.match(/^(?!.*coupons?).*rewards.*$/is)?t:!1}catch{return!1}}function yt(){if(!!y.querySelector("div").innerText.match(/Continue to Checkout/))return y.querySelector('div[style*="color: initial;"]')}async function Ct(t){f({action:"endSavingsCheck",comp:"coupert"});let e=[...t.querySelectorAll("div")].find(r=>r.textContent.match(/Congratulations!|You saved/)),o=0,n=[];if(e){let r=[...t.querySelectorAll("div p")].find(l=>l.textContent.includes("Congratulations!")),a=[...t.querySelectorAll("div div > div > div > div > div")].find(l=>l.textContent.includes("You saved")),i=r?r.previousElementSibling:a;if(i){let p=[...i.querySelectorAll("span, p")].find(M=>M.textContent==="With the code:")?.nextElementSibling?.textContent,m;a?m=[...a.querySelectorAll("div > div")].find(ct=>ct.innerText.includes("You saved")).nextElementSibling.textContent:m=i.previousElementSibling.textContent,m&&(o=C(m)),p&&n.push(p)}}u("track","coupertTryCouponsResult",{savings:o,coupons:n,url:location.href}),x(),h("coupert","coupons")}async function vt(){return d(J,t=>K())}function V(){return y.querySelector("[class*=cpui-btn-primary--]")}function K(){let t=V();if(t)return St(t),t}function St(t){let e=t.innerText;t.addEventListener("click",()=>{f({action:"initSavingsCheck",comp:"coupert"}),u("track","coupertTryCoupons",{ctaText:e,url:location.href}),g(yt,12e4,500,Ct)})}async function z(){d(J,t=>{let e=!1,o={childList:!0};new MutationObserver(a=>{k.default.forEach(a,async i=>{k.default.get(i,"type")==="childList"&&e===!1&&(e=!0,await vt())})}).observe(t,o);let r=K();if(r){let a=y.querySelector("[class^=cbButton]"),i=r.innerText,l=a?.innerText;u("track","coupertNotification",{name:"coupon",ctaText:i,url:location.href,secondaryCtaText:l})}})}function J(){try{let t=T();return!!t?.querySelector("div").innerText.match(/(coupons?|savings)/i)?t:!1}catch{return!1}}function T(){let e=[...document.querySelectorAll("div[data-reactroot]")].find(o=>{let n=o.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(o);if(n&&n.querySelector('link[href="chrome-extension://mfidniedemcgceagapgdekdbmanojomk/css/content.css"]'))return n});if(e){let o=e.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(e);return y=o,o}}var R=w(N());async function Q(){let t=await f({action:"getHoneyState",comp:"honey"}),e=await f({action:"getCompState",comp:"piggy"});!t&&!e&&d(gt,o=>{let[n,r]=wt(o);u("track","ebatesNotif",{url:location.href,cashbackRate:n,previousCashbackRate:r});let a=kt(o);a&&a.addEventListener("click",()=>{u("track","ebatesActivate",{url:location.href,cashbackRate:n,previousCashbackRate:r}),h("ebates","cashback")});let i=o.querySelector(".rr-button-close, [title^=Dismiss], .rr-tertiary");i&&i.addEventListener("click",()=>{u("track","ebatesDismiss",{url:location.href,cashbackRate:n,previousCashbackRate:r})})})}async function X(){await f({action:"getHoneyState",comp:"honey"})||d(bt,e=>{u("track","ebatesCouponNotif",{url:location.href});let o=[...e.querySelectorAll(".r-button")].find(r=>r.textContent.includes("Apply Coupons"));o&&o.addEventListener("click",()=>{u("track","ebatesTryCoupons",{url:location.href})});let n=e.querySelector(".rr-button-close, [aria-label^=Dismiss]");n&&n.addEventListener("click",()=>{u("track","ebatesCouponDismiss",{url:location.href})})})}function gt(){try{return Z().shadowRoot.querySelector(".ebates-notification")}catch{return!1}}function bt(){try{let t=Z().shadowRoot;return[...t.querySelectorAll(".r-button")].find(o=>o.textContent.includes("Apply Coupons"))?t.querySelector("aside[data-tid=coupons-magic-notification]"):!1}catch{return!1}}function kt(t){let e=t.querySelector(".rr-button-primary, button.r-button");return e&&/activate/i.test(e.innerText)?e:t.querySelector(".ebates-notification-button.ebates-notification-button-activate")||t.querySelector("ebates-notification-button.ebates-notification-button-login")}function wt(t){try{let e=t.querySelector(".ebates-notification .ebates-notification-button-activate")||t.querySelector(".rr-button-primary, button.r-button"),o=t.querySelector(".rr-text-secondary"),n=(0,R.default)(e).text(),r=(0,R.default)(o).text().trim()||void 0;return[n,r]}catch{return!1}}function Z(){return[...document.querySelectorAll("html > *")].find(t=>{if(t.shadowRoot&&t.shadowRoot.querySelector(".ebates-notification, aside[data-tid=coupons-magic-notification]"))return!0})}var v=w(N()),s=w(B());var c;function et(){try{let t=c?.querySelectorAll('#honey button[class*="primary"]');return t?.length&&t}catch{return!1}}function q(){try{let t=c?.querySelector("#honey-shadow"),e;if(t){let o=(0,v.default)(t).find("[id*=HoneyGoldAmount]").text()||(0,v.default)(t).find("[class*=DescriptiveGold] span[class*=textBold]").text()||(0,v.default)(t).find("[class^=ctaColumn] [class^=container] [class^=title]").text()||(0,v.default)(t).find('[class*=goldText] span:contains("Gold")').text()||(0,v.default)(t).find("[class^=valueContainer] [class*=price]").text()||(0,v.default)(t).find("[class^=subTextAndTerms] [class*=subText]").text(),n=o&&o.match(/(\d+[,\.]?\d*% to \d+[,\.]?\d*(?:%|\sHoney Gold|\sGold|\scash back))/);e=n?n[1]:null}return e}catch{return null}}function xt(){return new Promise((t,e)=>{d(et,o=>{let n=s.default.last(o);t(n)})})}function ot(){let t=c?.querySelector("#honey-shadow"),e;return t&&(e=(0,v.default)(t).find('[class*=bodyContentGreen] p:contains("Cart Total")').text(),e=C(e)),e}function nt(){let t=c?.querySelector("#honey-shadow"),e;return t&&(e=(0,v.default)(t).find("div:contains('re-activate Honey')").text()),!!e}function tt(){h("honey","cashback")}function Tt(t){let e=t?.innerText;u("track","activateHoney",{url:location.href,ctaText:e,cashbackRate:q(),reactivation:nt()})}function Rt(){d(et,t=>{let e=[...t].find(r=>r.innerText==="Apply Coupons"),o=qt(t);if(e){let r=ot(),a=e.textContent,i=q();e.addEventListener("click",()=>{o&&u("track","honeyTryCoupons",{url:location.href,cartTotal:r,ctaText:a,cashbackRate:i}),f({action:"initSavingsCheck",comp:"honey"}),g(at,4e4,500,it)})}o&&o.addEventListener("click",tt);let n=Mt(t);n&&n.addEventListener("click",()=>{Tt(n),tt()})})}async function rt(){try{g(at,4e4,500,it),d(()=>{let e=[...document.querySelectorAll("#honeyContainer, div[data-reactroot]")].find(o=>{let n=o.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(o);return n&&n?.getElementById("honey-shadow")});if(e)return e.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(e)},async t=>{c=t,Rt();let e=await xt(),o=e?e.textContent:null,n=ot(),r=s.default.debounce(l=>{u("track",l?"showHoney":"hideHoney",{url:location.href,cartTotal:n,ctaText:o,cashbackRate:q(),reactivation:nt()})},1e3),a=new MutationObserver(l=>{s.default.forEach(l,p=>{let m=s.default.get(p,"target.style.visibility");m==="hidden"?r(!1):(m==="initial"||m==="visible")&&r(!0)})}),i=c?.querySelector("#honey-shadow");if(i){a.observe(i,{attributes:!0,attributeFilter:["style"]});let l=i?.style?.visibility;l==="hidden"?r(!1):(l==="initial"||l==="visible")&&r(!0)}})}catch{}}function it(t){f({action:"endSavingsCheck",comp:"honey"});let e=s.default.get(t,"savings")&&typeof t.savings=="number"?+t.savings:null,o=s.default.get(t,"originalPrice")&&typeof t.originalPrice=="number"?+t.originalPrice:null,n=s.default.get(t,"withHoneyPrice")&&typeof t.withHoneyPrice=="number"?+t.withHoneyPrice:null;u("track","honeyTryCouponsResult",{savings:e,rewardsSavings:s.default.get(t,"rewards",null),originPrice:o,finalPrice:n,codeApplied:s.default.get(t,"workingCode",null),url:location.href}),h("honey","coupons",()=>b.set(["warnAboutStandDown"],!0))}function qt(t){return s.default.find(t,e=>/coupon(?:s)?|code(?:s)?/i.test(e.innerHTML))||s.default.find(c?.querySelector("#honey")?.querySelectorAll("span"),e=>e.innerHTML==="Coupon codes")}function Mt(t){return s.default.find(t,e=>/claim honey gold|claim rewards|activate cash back|activate rewards/i.test(e.innerHTML))}var Et=[()=>{try{let t=/You saved|you’re saving/i;if(c?.innerHTML.match(t)){let o=s.default.get(c?.querySelector("[class*=savingsPrice], [class^=savingsText]"),"textContent"),n=o?C(o):null,r=s.default.get(c?.querySelector("[id*=OriginalPrice], [class^=originalTotal]"),"textContent"),a=r?C(r):null,i=s.default.get(c?.querySelector("[id*=WithHoneyPrice], [class^=price].price5"),"textContent"),l=i?C(i):null,p=s.default.get(c?.querySelector("[id*=HoneyGoldAmount], [class^=valueContainer] > [class^=value]"),"textContent"),m=s.default.get(c?.querySelector("[class*=workingCode], [class*=bestCode-]"),"textContent");return{foundModal:!0,savings:n,rewards:p,originalPrice:a,withHoneyPrice:l,workingCode:m}}}catch{}return!1},()=>{try{let t=/Honey Gold.+activated/i;if(c?.innerHTML.match(t))return{foundModal:!0,rewards:s.default.get(c?.querySelector("[class*=DescriptiveGold] span[class*=textBold]"),"textContent")}}catch{}return!1},()=>{try{let t=/forget your free sample/i;if(c?.innerHTML.match(t)){let o=s.default.get(c?.querySelector("[id*=FreeItemReceipt][id*=titleContent]"),"textContent"),n=o?C(o):null,r=s.default.get(c?.querySelector("[id*=honeyGoldContainer] [class*=bold]"),"textContent"),a=c?.querySelectorAll("[class*=couponsContainer] [class*=couponPointer] [class*=couponTitle]"),i=s.default.map(a,l=>l.textContent);return{foundModal:!0,savings:n,rewards:r,workingCode:i}}}catch{}return!1},()=>{try{let t=/have the best/i;if(c?.innerHTML.match(t)){let o=c?.querySelector("[class^=price]")?.textContent;return{foundModal:!0,withHoneyPrice:o?C(o):void 0}}}catch{}return!1},()=>{try{let t=/Get.+Gold back/;if(c?.innerHTML.match(t))return{foundModal:!0,rewards:s.default.get(c?.querySelector("[id*=bonusCashContentContainer] [id*=span-bonusCashContent]"),"textContent")}}catch{}return!1},()=>{try{let t=/\d+% back|activated/;if(c?.innerHTML.match(t))return{foundModal:!0,rewards:s.default.get(c?.querySelector("[id*=bonusCashContentContainer] [id*=span-bonusCashContent]"),"textContent")}}catch{}return!1},()=>{try{let t=/you’re earning cash back/i;if(c?.innerHTML.match(t))return{foundModal:!0,rewards:s.default.get(c?.querySelector("[class^=valueContainer] [class*=price]"),"textContent")}}catch{}return!1}];function at(){let t=!1;return s.default.forEach(Et,e=>{let o=e();if(s.default.has(o,"foundModal")){t=o;return}}),t}function Lt(){function t(){d(()=>document.querySelector('form[action*="i.clean.gg"]'),e=>{u("track","extensionError",{type:"possible_error",source:"clean"})})}document.readyState!=="loading"?t():document.addEventListener("DOMContentLoaded",t)}async function G(){let t=P();return t=await A({message:"getPlatformDomain"})||t,t}var be=()=>{rt(),Q(),X(),I(),Y(),z(),Lt()};export{g as a,be as b,h as c};
