import{a as d}from"../../../../chunks/chunk-U4SHFVNS.js";import{a as w,c as E}from"../../../../chunks/chunk-4OSQ3AVR.js";import{a as C}from"../../../../chunks/chunk-Q4YJXWHS.js";import{a}from"../../../../chunks/chunk-SPMXOJK3.js";import{a as v}from"../../../../chunks/chunk-BCG2KUGW.js";import"../../../../chunks/chunk-ZRXJBILZ.js";import"../../../../chunks/chunk-O4TFJKJQ.js";import{g as R,o as l}from"../../../../chunks/chunk-3DTL4XOQ.js";import"../../../../chunks/chunk-RXMLGJMT.js";import"../../../../chunks/chunk-WSYZUFNR.js";import"../../../../chunks/chunk-VCHBXYSK.js";import"../../../../chunks/chunk-JDJMGFXU.js";import"../../../../chunks/chunk-733SXZOW.js";import"../../../../chunks/chunk-U7FXM4JE.js";import"../../../../chunks/chunk-ZZJM66LV.js";import"../../../../chunks/chunk-PDIOZR2P.js";import"../../../../chunks/chunk-AT6M4CEW.js";import"../../../../chunks/chunk-3GYLW4KZ.js";async function c(e,o={},t){l("track",e,{...o,url:location.href,source:t})}function q(e){return/%s/.test(e)?e.replace(/%/,"% "):e}function s(e,o,t){let n=o?.textContent?.trim()?.replace(/[\t\n\r\s]+/gm," ");c("pieNotification",{name:e,ctaText:q(n)},t)}function y(e){return[...e].find(t=>/Apply Coupons/i.test(t.innerHTML))}function g(e){return[...e].find(o=>/activate up|cash back/i.test(o.innerHTML))}var f,b,k,N=()=>{try{let e=f?.querySelectorAll("#root button");return e?.length&&e}catch{return!1}};function H(){try{let e=b?.querySelectorAll("#root button");return e?.length&&e}catch{return!1}}function D(e){return[...e].find(t=>/rewards/i.test(t.innerHTML))}function F(){a(H,e=>{let o=D(e);if(o){let t=o.textContent||void 0,r=b?.querySelector("#root svg #Vector")?.parentElement?.parentElement,p=r?.parentElement?.nextElementSibling?.querySelector("div"),S=p?.nextElementSibling,M=p?.textContent||void 0,P=S?.textContent||void 0;c("pieNotification",{name:"placement",ctaText:t,header:M,bodyText:P},"adblock"),o.addEventListener("click",()=>{if(o){let O=r?.nextElementSibling?.textContent||void 0;c("pieActivate",{name:"placement",ctaText:t,cashbackRate:O},"adblock")}})}})}function _(){a(N,e=>{let o=y(e);if(o){s("coupon",o,"shopping");let n=o.textContent||void 0,r=d(n);o.addEventListener("click",()=>{o&&c("pieTryCoupons",{url:location.href,ctaText:n,cashbackRate:r},"shopping")})}let t=g(e);if(t){s("cashback",t,"adblock");let n=t.textContent||void 0,r=d(n);t.addEventListener("click",()=>{t&&c("pieActivate",{url:location.href,ctaText:n,cashbackRate:r},"adblock")})}})}async function W(){a(()=>{let o=[...document.querySelectorAll('div[style^="all: initial !important;"]')].find(t=>{let n=t.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(t);return n&&n?.querySelector('style[data-emotion="pie"]')});if(o)return o.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(o)},async e=>{b=e,F(),_()})}async function V(){if(k){let e=[...k.querySelectorAll("p")].find(o=>{if(typeof o.textContent=="string")return/rewards/i.test(o.textContent)});e&&s("adUnblocked",e,"adblock")}}async function U(){a(()=>{let o=[...document.querySelectorAll("div")].find(t=>{let n=t.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(t);return n&&n?.querySelector("#modal_container")});if(o)return o.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(o)},async e=>{k=e,V()})}async function I(){let e=f?.querySelector('#pie_adb_hover_container[style*="right: -"], #detect-ads-popup[style*="right: -"]');if(f){let o=[...f.querySelectorAll("#pie_adb_hover_container > div, #detect-ads-popup > div")].find(t=>{if(typeof t.textContent=="string")return/%[\n.\s]*.+saved/i.test(t.textContent)});o&&!e&&s("adBlocked",o,"adblock")}}async function j(){a(()=>{let o=[...document.querySelectorAll('div[style^="all: initial !important;"]')].find(t=>{let n=t.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(t);return n&&n?.querySelector('style[data-emotion="pie-global"]')&&!n?.querySelector("div")?.textContent?.includes("Report Bug")});if(o)return o.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(o)},async e=>{f=e,I()})}async function x(){try{j(),W(),document.querySelector("#pie_logo")&&U()}catch{}}var u,m,z=()=>{try{m&&(m=void 0);let e=u?.querySelectorAll("#root button");return e?.length&&e}catch{return!1}};function G(e){if(/cash back/i.test(e.innerHTML))return e?.textContent}function L(e){C({action:"endSavingsCheck",comp:"pie"});let o=e.savings&&typeof e.savings=="number"?+e.savings:null,t=typeof m=="number"&&Date.now()-m;l("track","pieTryCouponsResult",{savings:o,cashbackRate:e?.rewards||null,coupons:e?.coupons||[],runTime:t,url:location.href}),E("pie","coupons",()=>R.set(["warnAboutStandDown"],!0))}function J(){a(z,e=>{let o=y(e);if(o){s("coupon",o,"shopping");let n=o.textContent||void 0,r=d(n);o.addEventListener("click",()=>{m=Date.now(),o&&c("pieTryCoupons",{url:location.href,ctaText:n,cashbackRate:r},"shopping"),C({action:"initSavingsCheck",comp:"pie"}),w(T,4e4,500,L)})}let t=g(e);if(t){s("cashback",t,"shopping");let n=t.textContent||void 0,r=d(n);t.addEventListener("click",()=>{t&&c("pieActivate",{url:location.href,ctaText:n,cashbackRate:r},"shopping")})}})}async function A(){w(T,4e4,500,L);try{a(()=>{let o=[...document.querySelectorAll('div[style^="all: initial !important;"]')].find(t=>{let n=t.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(t);return n&&n?.querySelector('style[data-emotion="pie-global"]')&&n?.querySelector("div")?.textContent?.includes("Report Bug")});if(o)return o.openOrClosedShadowRoot||chrome.dom?.openOrClosedShadowRoot?.(o)},async e=>{u=e,J()})}catch{}}var K=[()=>{try{if(u){let e=[],o=/Continue to Checkout/i;if(u.innerHTML.match(o)){let n=[...u.querySelectorAll("span")].find(S=>S?.textContent?.includes("Cash Back")),r;n&&(r=G(n));let i=u?.querySelector('svg[fill="currentColor"]')?.nextElementSibling,h=i?.textContent,p=i?.parentElement?.nextElementSibling?.textContent;return h&&e.push(h),{foundModal:!0,savings:p?v(p):void 0,rewards:r,coupons:e}}}}catch{}return!1}];function T(){let e=!1;return K.forEach(o=>{let t=o();if(t&&t.foundModal){e=t;return}}),e}function B(){new RegExp("https://(www\\.)?pie.org").test(location.href)&&(Q(),X())}function Q(){let e=location.href;setInterval(()=>{location.href!==e&&(chrome.runtime.sendMessage({type:"pageView",url:location.href,referrer:document.referrer,title:document.title}),e=location.href)},500)}function X(){document.addEventListener("click",e=>{let t=e.target,n=0,r=5;for(;t&&n<r&&!(t.localName==="button"||t.getAttribute("type")==="button");)t=t.parentElement,n++;if(!t||n>=r)return;let i=t.textContent?.trim();i||(i=t.getAttribute("aria-label")||""),!i&&t.localName==="img"&&(i=t.src),i||(i=t.querySelector("img")?.src||""),l("track","cPageClick",{label:i})},!0)}B();A();x();
